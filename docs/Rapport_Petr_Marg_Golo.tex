\documentclass[a4paper,10pt,openany,oneside]{book}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[francais]{babel}
\usepackage[hidelinks]{hyperref}
\usepackage{wrapfig}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings} %Pour le code
\usepackage{amsmath}
\usepackage{changepage}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{myblue}{rgb}{0,0,1}



\lstset{frame=tb,
  language=C++,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=left,
  numberstyle=\normalsize,
  numbersep=7pt,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

\begin{document}
\title{Rapport P2 Qt}
\author{Damian Petroff, Sergiy Goloviatinski, Raphaël Margueron}
\maketitle

\tableofcontents
\thispagestyle{empty}


\chapter{Introduction}
\setcounter{page}{1}
\thispagestyle{headings}

\chapter{Analyse}
\thispagestyle{headings}

\section{Spécifications}

\chapter{Conception}
\thispagestyle{headings}

\section{Cas d'utilisation}

\section{Planification initiale}

\section{Planification finale}

\section{Diagramme de classe}

\section{Schéma procédural d'utilisation}

\chapter{Développement}
\thispagestyle{headings}

\section{Génération des sols}
Pour la gestion du terrain, nous avons décidé d'avoir deux types de sol, l'eau et l'herbe. Sur l'herbe, il est possible d'ajouter des bâtiments et sur l'eau non.

Pour pouvoir avoir des cartes auto-générée, nous avons décide d'utiliser un algorithme de bruit de Perlin. Nous n'allons pas aller dans les détails du fonctionnement du bruit de Perlin, dans ce rapport. Mais principe est le suivant, il permet d'avoir des nombres aléatoires qui sont proche les uns de autres en function d'une seed(initialisé au début) et de 1, 2 ou X dimensions (trois dans celui que nous avons utilisés, mais que 2 utilisés).  Vu que les outputs de la function de bruit de Perlin sont les mêmes quand nous utilisons les mêmes inputs. Nous pouvons la considéré comme une fonction à plusieurs variables (qui sont les dimensions et la seed). 

Les nombres aléatoires que nous récupérons de la function sont des nombres flottant entre 0 et 1.
Leurs distribution sont sous la forme d'une distribution normal.
\[y=e^{-x^{2}}\]

Pour pouvoir générer la carte nous parcourons toutes les cases de la carte (selon x et y). Et "nous déplaçons sur le function de Perlin" d'un certain offset (qui n'est pas le même que les index des cases). 
\section{Gestion du  bonheur}

\section{Routes et bâtiments}
Pour la gestion des routes et des bâtiments nous sommes parti sur une approche plutôt simple qui est d'avoir divisé en trois classe qui chacune des rôles spécifique. Une qui décrit les caractéristiques propre à chaque bâtiments : les constantes -> ConstantBuilding. Une seconde classe qui décrit une bâtiment spécifique à la partie -> Building. Et une troisième qui sert de gestionnaires de building, 'classe tableau' -> Building Manager. 

Constant Building :
Constant Building contient une function de construction d'un tableau d'objet de 'soit même'. Chacun de ces objet représente un bâtiment avec toutes ces caractéristiques internes, par exemple : le prix de construction, la liste des bâtiments nécessaires pour sa construction ou encore sa catégorie dans l'affichage de l'HUD.

Liste de caractéristique de base de chaque bâtiment :
\begin{itemize}
	\item Nom à l'affichage
	\item Catégorie
	\item Prix
	\item Largeur (au sol)
	\item Hauteur (au sol)
	\item Une liste de case ignoré (non-implémenté, pour avoir la possibilité d'avoir de bâtiment non rectangulaire)
	\item Type de pré-requis (Ou / Et)
	\item Une liste d'identifiant de bâtiment pré-requis.
	\item La sommes des pré-requis nécessaires. 
\end{itemize}

Nous avons choisi d'avoir des objets au lieu d'une liste de constante, pour pouvoir avoir la possibilité d'y ajouter des fonctions pour ces objets ce qui nous a permis d'avoir un autre set de valeur basé sur les caractéristiques de base, voir ci-dessous. Cela nous permet ajuster facilement le jeu et d'avoir une sorte de progression linaire du jeu, voir ci-dessous.

Liste des caractéristique dérivé :
\begin{itemize}
  \item Prix par secondes = Prix / 4
  \item Efficacité = \((Prix/10)^{1.4} + 10\) (arrondi au multiple de 25 le plus proche)
  \item Rayon d'action = \(Log10((PrixParSecondes*Efficacité + 1))\) (Arrondi au multiple de 5 le plus proche)
  \item Poids du bâtiment dans les pré-requis = Prix / 10
\end{itemize}

On remarque donc que le prix du bâtiment influe directement sur tous les caractéristique qui définisse si le bâtiment est performant ou non.

Fonctionnement des pré-requis :
Les pré-requis sont un aspect que nous considérons comme l'élément primordiale permettant au jeu d'avoir une progression. Le principe est le suivant.

Pour qu'un bâtiment soit accessible à la construction il faut qu'il respect les règles suivantes si son type de pré-requis est 'ou' :
La somme des poids de tous les bâtiments qui sont actuellement posé qui sont dans la liste des bâtiments en pré-requis du bâtiment désiré doit être supérieur ou égal à la somme des pré-requis nécessaires.
Exemple :
Pour poser un Laboratoire médical : Il faut au moins une somme de 6.
La liste des bâtiments pré-requis et des poids pour le laboratoire est la suivante :
\begin{itemize}
	\item Clinique : 1
	\item Hôpital : 5
\end{itemize}
Il y a donc au moins trois possibilités pour arrivé à remplir cette demande :
\begin{itemize}
	\item 6x Clinique
	\item 1x Clinique et 1x Hôpital (Meilleur solution, au niveau du prix par seconde de le efficacité sur un grand rayon)
	\item 2x Hôpital
\end{itemize}

Pour les pré-requis en 'et' :
Il faut en plus que pour les pré-requis en 'ou', avoir au moins un bâtiment de chaque type de la liste des bâtiments pré-requis.
Exemple :
Pour poser une Tour Eiffel : Il faut au moins une somme de 11.5
La liste des bâtiments pré-requis et des poids pour le laboratoire est la suivante :
\begin{itemize}
	\item Hôpital : 5
	\item Caserne de pompier : 1.5
	\item Quartiers généraux : 5
\end{itemize}

Il y a donc au moins une possibilité pour arrivé à remplir cette demande, qui est d'avoir une bâtiment de chaque. A noter que dans ce cas, la somme de pré-requis n'influence pas pour ce bâtiment, mais on pourrai imaginer qu'un bâtiment aille une somme plus grande que la somme de chaque bâtiment pré-requis et la la somme aurai une influence.
	
Building :
La classe building décrit un bâtiment posé dans une partie. Il est décris les caractéristiques suivantes :
\begin{itemize}
	\item Un identifiant unique
	\item Un identifiant du type de bâtiment (de ConstantBuilding)
	\item Une position X/Y
	\item Un angle de rotation (De quel côté est posé le bâtiment, non-implémenté)
	\item Une population
\end{itemize}

On peut donc noter que cet objet est rendu assez 'léger' car la plus part de ce qui le décrit est géré par l'identifiant constant building. Nous pouvons donc avoir beaucoup de bâtiment et avoir une emprunte mémoire peu conséquente.

Building Manager :
Cette classe permet de gérer une liste de bâtiment de la classe Building. On peut exécuté les actions suivante :
\begin{itemize}
	\item Ajouter un bâtiments (qui est ajoutable selon les pré-requis)
	\item Supprimer des bâtiments 
	\item Récupérer la population total de la ville.
	\item Récupérer le bonheur moyen de la ville.
	\item Récupérer la somme des prix par seconde.
\end{itemize}

Les fonctions de récupération retournent un valeur stocké mais la valeur stock est recalculé si le besoin l'est, par exemple le bonheur moyen ne varie pas selon le temps mais si un nouveau bâtiment est placé on doit donc recalculer le bonheur moyen.

\section{Gestion du son}
Pour la gestion du son nous avons décider de pouvoir traiter facilement les musiques et les bruitages du jeu avec un mixeur. Nous avons donc crée une classe. L'HUD supérieur permet de la piloté à l'aide de trois sliders : Un pour le contrôle du volume de la musique, un pour celui des bruitages et un troisième englobant les deux, appelé master.

\section{Launcher et gestion des sauvegardes}


\chapter{Tests}
\thispagestyle{headings}
\section{Protocoles de tests}
\section{

\chapter{Bilan}
\thispagestyle{headings}


\chapter{Conclusion}
\thispagestyle{headings}


\chapter{Annexes}
\thispagestyle{headings}

\end{document}